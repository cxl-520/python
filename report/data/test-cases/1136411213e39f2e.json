{"uid":"1136411213e39f2e","name":"后台登录-验证码识别自动填充","fullName":"testcase.test_ui.test_excel.TestExcel#test_登陆后台存在验证码","historyId":"81d7c70fdc84a43793845e1ededef88c","time":{"start":1771127770840,"stop":1771127775506,"duration":4666},"description":"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    ","descriptionHtml":"<pre><code>### 测试场景：\n1. 复用登录夹具的driver\n2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n### 预期结果：\n验证码识别并填充，登录按钮点击成功\n</code></pre>\n","status":"failed","statusMessage":"Failed: 后台登录操作失败：IMAGE","statusTrace":"self = <testcase.test_ui.test_excel.TestExcel object at 0x0000020ADB9C7F10>\ntest_login2 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ebd1e827bd1c0c17ea27ed2b911658af\")>\ndata_json = {'password': 111111111, 'username': 'liuzhuozhuo'}\n\n    @allure.title(\"后台登录-验证码识别自动填充\")\n    @allure.severity(allure.severity_level.CRITICAL)  # 核心登录流程，对应报告critical柱\n    @allure.description(\"\"\"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    \"\"\")\n    def test_登陆后台存在验证码(self, test_login2, data_json):\n        try:\n            with allure.step(\"步骤1：获取driver并输入账号密码\"):\n                driver = test_login2\n                # 原有账号输入逻辑保留\n                username = driver.find_element(By.XPATH, '//*[@id=\"pd-form-username\"]')\n                username.clear()\n                username.send_keys(data_json.get(\"username\"))\n                sleep(2)\n                pwd = driver.find_element(By.XPATH, '//*[@id=\"pd-form-password\"]')\n                pwd.clear()\n                pwd.send_keys(data_json.get(\"password\"))\n                sleep(2)\n                # 新增：账号密码输入后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"账号密码输入后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n            with allure.step(\"步骤2：截图验证码并识别文字\"):\n                # 原有验证码截图逻辑保留\n                captcha_img = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/span/img')\n                captcha_img.screenshot(\"./captcha.jpg\")\n                # 新增：将验证码图片附加到Allure报告\n>               allure.attach.file(\"./captcha.jpg\", name=\"验证码截图\", attachment_type=allure.attachment_type.IMAGE)\n\ntestcase\\test_ui\\test_excel.py:73: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ncls = <enum 'AttachmentType'>, name = 'IMAGE'\n\n    def __getattr__(cls, name):\n        \"\"\"\n        Return the enum member matching `name`\n    \n        We use __getattr__ instead of descriptors or inserting into the enum\n        class' __dict__ in order to support `name` and `value` being both\n        properties for enum members (which live in the class' __dict__) and\n        enum members themselves.\n        \"\"\"\n        if _is_dunder(name):\n            raise AttributeError(name)\n        try:\n            return cls._member_map_[name]\n        except KeyError:\n>           raise AttributeError(name) from None\nE           AttributeError: IMAGE\n\n..\\..\\AppData\\Local\\Programs\\Python\\Python39\\lib\\enum.py:429: AttributeError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <testcase.test_ui.test_excel.TestExcel object at 0x0000020ADB9C7F10>\ntest_login2 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ebd1e827bd1c0c17ea27ed2b911658af\")>\ndata_json = {'password': 111111111, 'username': 'liuzhuozhuo'}\n\n    @allure.title(\"后台登录-验证码识别自动填充\")\n    @allure.severity(allure.severity_level.CRITICAL)  # 核心登录流程，对应报告critical柱\n    @allure.description(\"\"\"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    \"\"\")\n    def test_登陆后台存在验证码(self, test_login2, data_json):\n        try:\n            with allure.step(\"步骤1：获取driver并输入账号密码\"):\n                driver = test_login2\n                # 原有账号输入逻辑保留\n                username = driver.find_element(By.XPATH, '//*[@id=\"pd-form-username\"]')\n                username.clear()\n                username.send_keys(data_json.get(\"username\"))\n                sleep(2)\n                pwd = driver.find_element(By.XPATH, '//*[@id=\"pd-form-password\"]')\n                pwd.clear()\n                pwd.send_keys(data_json.get(\"password\"))\n                sleep(2)\n                # 新增：账号密码输入后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"账号密码输入后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n            with allure.step(\"步骤2：截图验证码并识别文字\"):\n                # 原有验证码截图逻辑保留\n                captcha_img = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/span/img')\n                captcha_img.screenshot(\"./captcha.jpg\")\n                # 新增：将验证码图片附加到Allure报告\n                allure.attach.file(\"./captcha.jpg\", name=\"验证码截图\", attachment_type=allure.attachment_type.IMAGE)\n    \n                # 原有验证码识别逻辑保留\n                captcha_text = pytesseract.image_to_string(Image.open(\"captcha.jpg\").convert(\"L\")).strip()\n                print(f\"识别到的验证码: {captcha_text}\")\n                # 新增：记录识别到的验证码到报告\n                allure.attach(captcha_text, name=\"识别到的验证码\", attachment_type=allure.attachment_type.TEXT)\n    \n            with allure.step(\"步骤3：填充验证码并点击登录按钮\"):\n                # 原有验证码输入逻辑保留\n                yzn_send = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/input')\n                yzn_send.clear()\n                yzn_send.send_keys(captcha_text)\n                sleep(10)\n                # 新增：验证码填充后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"验证码填充后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n                # 原有登录按钮点击逻辑保留\n                btn = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[6]/button')\n                btn.click()\n                sleep(10)\n                # 新增：点击登录后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"点击登录按钮后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n        # 新增：异常捕获，记录异常信息和截图\n        except Exception as e:\n            allure.attach(driver.get_screenshot_as_png(), name=\"登录异常截图\",\n                          attachment_type=allure.attachment_type.PNG)\n            allure.attach(str(e), name=\"异常信息\", attachment_type=allure.attachment_type.TEXT)\n>           pytest.fail(f\"后台登录操作失败：{str(e)}\")\nE           Failed: 后台登录操作失败：IMAGE\n\ntestcase\\test_ui\\test_excel.py:104: Failed","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"test_login2","time":{"start":1771127767335,"stop":1771127770839,"duration":3504},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"testStage":{"description":"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    ","status":"failed","statusMessage":"Failed: 后台登录操作失败：IMAGE","statusTrace":"self = <testcase.test_ui.test_excel.TestExcel object at 0x0000020ADB9C7F10>\ntest_login2 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ebd1e827bd1c0c17ea27ed2b911658af\")>\ndata_json = {'password': 111111111, 'username': 'liuzhuozhuo'}\n\n    @allure.title(\"后台登录-验证码识别自动填充\")\n    @allure.severity(allure.severity_level.CRITICAL)  # 核心登录流程，对应报告critical柱\n    @allure.description(\"\"\"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    \"\"\")\n    def test_登陆后台存在验证码(self, test_login2, data_json):\n        try:\n            with allure.step(\"步骤1：获取driver并输入账号密码\"):\n                driver = test_login2\n                # 原有账号输入逻辑保留\n                username = driver.find_element(By.XPATH, '//*[@id=\"pd-form-username\"]')\n                username.clear()\n                username.send_keys(data_json.get(\"username\"))\n                sleep(2)\n                pwd = driver.find_element(By.XPATH, '//*[@id=\"pd-form-password\"]')\n                pwd.clear()\n                pwd.send_keys(data_json.get(\"password\"))\n                sleep(2)\n                # 新增：账号密码输入后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"账号密码输入后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n            with allure.step(\"步骤2：截图验证码并识别文字\"):\n                # 原有验证码截图逻辑保留\n                captcha_img = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/span/img')\n                captcha_img.screenshot(\"./captcha.jpg\")\n                # 新增：将验证码图片附加到Allure报告\n>               allure.attach.file(\"./captcha.jpg\", name=\"验证码截图\", attachment_type=allure.attachment_type.IMAGE)\n\ntestcase\\test_ui\\test_excel.py:73: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ncls = <enum 'AttachmentType'>, name = 'IMAGE'\n\n    def __getattr__(cls, name):\n        \"\"\"\n        Return the enum member matching `name`\n    \n        We use __getattr__ instead of descriptors or inserting into the enum\n        class' __dict__ in order to support `name` and `value` being both\n        properties for enum members (which live in the class' __dict__) and\n        enum members themselves.\n        \"\"\"\n        if _is_dunder(name):\n            raise AttributeError(name)\n        try:\n            return cls._member_map_[name]\n        except KeyError:\n>           raise AttributeError(name) from None\nE           AttributeError: IMAGE\n\n..\\..\\AppData\\Local\\Programs\\Python\\Python39\\lib\\enum.py:429: AttributeError\n\nDuring handling of the above exception, another exception occurred:\n\nself = <testcase.test_ui.test_excel.TestExcel object at 0x0000020ADB9C7F10>\ntest_login2 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ebd1e827bd1c0c17ea27ed2b911658af\")>\ndata_json = {'password': 111111111, 'username': 'liuzhuozhuo'}\n\n    @allure.title(\"后台登录-验证码识别自动填充\")\n    @allure.severity(allure.severity_level.CRITICAL)  # 核心登录流程，对应报告critical柱\n    @allure.description(\"\"\"\n    ### 测试场景：\n    1. 复用登录夹具的driver\n    2. 读取Excel账号密码 → 输入账号密码 → 截图验证码并识别 → 填充验证码 → 点击登录\n    ### 预期结果：\n    验证码识别并填充，登录按钮点击成功\n    \"\"\")\n    def test_登陆后台存在验证码(self, test_login2, data_json):\n        try:\n            with allure.step(\"步骤1：获取driver并输入账号密码\"):\n                driver = test_login2\n                # 原有账号输入逻辑保留\n                username = driver.find_element(By.XPATH, '//*[@id=\"pd-form-username\"]')\n                username.clear()\n                username.send_keys(data_json.get(\"username\"))\n                sleep(2)\n                pwd = driver.find_element(By.XPATH, '//*[@id=\"pd-form-password\"]')\n                pwd.clear()\n                pwd.send_keys(data_json.get(\"password\"))\n                sleep(2)\n                # 新增：账号密码输入后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"账号密码输入后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n            with allure.step(\"步骤2：截图验证码并识别文字\"):\n                # 原有验证码截图逻辑保留\n                captcha_img = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/span/img')\n                captcha_img.screenshot(\"./captcha.jpg\")\n                # 新增：将验证码图片附加到Allure报告\n                allure.attach.file(\"./captcha.jpg\", name=\"验证码截图\", attachment_type=allure.attachment_type.IMAGE)\n    \n                # 原有验证码识别逻辑保留\n                captcha_text = pytesseract.image_to_string(Image.open(\"captcha.jpg\").convert(\"L\")).strip()\n                print(f\"识别到的验证码: {captcha_text}\")\n                # 新增：记录识别到的验证码到报告\n                allure.attach(captcha_text, name=\"识别到的验证码\", attachment_type=allure.attachment_type.TEXT)\n    \n            with allure.step(\"步骤3：填充验证码并点击登录按钮\"):\n                # 原有验证码输入逻辑保留\n                yzn_send = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[4]/input')\n                yzn_send.clear()\n                yzn_send.send_keys(captcha_text)\n                sleep(10)\n                # 新增：验证码填充后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"验证码填充后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n                # 原有登录按钮点击逻辑保留\n                btn = driver.find_element(By.XPATH, '//*[@id=\"login-form\"]/div[6]/button')\n                btn.click()\n                sleep(10)\n                # 新增：点击登录后截图\n                allure.attach(driver.get_screenshot_as_png(), name=\"点击登录按钮后截图\",\n                              attachment_type=allure.attachment_type.PNG)\n    \n        # 新增：异常捕获，记录异常信息和截图\n        except Exception as e:\n            allure.attach(driver.get_screenshot_as_png(), name=\"登录异常截图\",\n                          attachment_type=allure.attachment_type.PNG)\n            allure.attach(str(e), name=\"异常信息\", attachment_type=allure.attachment_type.TEXT)\n>           pytest.fail(f\"后台登录操作失败：{str(e)}\")\nE           Failed: 后台登录操作失败：IMAGE\n\ntestcase\\test_ui\\test_excel.py:104: Failed","steps":[{"name":"步骤1：获取driver并输入账号密码","time":{"start":1771127770841,"stop":1771127775270,"duration":4429},"status":"passed","steps":[],"attachments":[{"uid":"bf6e59a853736b0a","name":"账号密码输入后截图","source":"bf6e59a853736b0a.png","type":"image/png","size":31169}],"parameters":[],"hasContent":true,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"attachmentStep":false},{"name":"步骤2：截图验证码并识别文字","time":{"start":1771127775271,"stop":1771127775394,"duration":123},"status":"broken","statusMessage":"AttributeError: IMAGE\n","statusTrace":"  File \"C:\\Users\\Administrator\\PycharmProjects\\PythonProject\\testcase\\test_ui\\test_excel.py\", line 73, in test_登陆后台存在验证码\n    allure.attach.file(\"./captcha.jpg\", name=\"验证码截图\", attachment_type=allure.attachment_type.IMAGE)\n  File \"C:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python39\\lib\\enum.py\", line 429, in __getattr__\n    raise AttributeError(name) from None\n","steps":[],"attachments":[],"parameters":[],"hasContent":true,"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"attachments":[{"uid":"a5c14c8e891ca357","name":"登录异常截图","source":"a5c14c8e891ca357.png","type":"image/png","size":45309},{"uid":"3974aa06f6d4da29","name":"异常信息","source":"3974aa06f6d4da29.txt","type":"text/plain","size":5},{"uid":"61ec03dea0b8d6b4","name":"log","source":"61ec03dea0b8d6b4.txt","type":"text/plain","size":419}],"parameters":[],"hasContent":true,"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":4,"attachmentStep":false},"afterStages":[{"name":"test_login2::0","time":{"start":1771127775534,"stop":1771127777748,"duration":2214},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"labels":[{"name":"feature","value":"后台系统登录自动化测试"},{"name":"severity","value":"critical"},{"name":"story","value":"Excel数据驱动+验证码识别登录"},{"name":"parentSuite","value":"testcase.test_ui"},{"name":"suite","value":"test_excel"},{"name":"subSuite","value":"TestExcel"},{"name":"host","value":"PC-20250907ITIM"},{"name":"thread","value":"15456-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcase.test_ui.test_excel"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"data_json","value":"{'username': 'liuzhuozhuo', 'password': 111111111}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"history":{"statistic":{"failed":1,"broken":2,"skipped":0,"passed":1,"unknown":0,"total":4},"items":[{"uid":"d2a3813a1665694d","status":"broken","statusDetails":"selenium.common.exceptions.NoSuchElementException: Message: no such element: Unable to locate element: {\"method\":\"xpath\",\"selector\":\"//*[@id=\"pd-form-username\"]\"}\n  (Session info: chrome=144.0.7559.60); For documentation on this error, please visit: https://www.selenium.dev/documentation/webdriver/troubleshooting/errors#nosuchelementexception\nStacktrace:\nSymbols not available. Dumping unresolved backtrace:\n\t0x7ff6097888d5\n\t0x7ff609788930\n\t0x7ff60956165d\n\t0x7ff6095b9a33\n\t0x7ff6095b9d3c\n\t0x7ff60960df67\n\t0x7ff60960ac97\n\t0x7ff6095aac29\n\t0x7ff6095aba93\n\t0x7ff609aa0620\n\t0x7ff609a9af60\n\t0x7ff609ab96c6\n\t0x7ff6097a5dd4\n\t0x7ff6097aed7c\n\t0x7ff609791ff4\n\t0x7ff6097921a5\n\t0x7ff609777ed2\n\t0x7ffd1344259d\n\t0x7ffd155caf38","time":{"start":1770799644606,"stop":1770799654616,"duration":10010}},{"uid":"32f022a517487e8d","status":"broken","statusDetails":"urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(10054, '远程主机强迫关闭了一个现有的连接。', None, 10054, None))","time":{"start":1770799313017,"stop":1770799316540,"duration":3523}},{"uid":"9ed3c6097e512366","status":"passed","time":{"start":1770798158174,"stop":1770798183020,"duration":24846}}]},"tags":[]},"source":"1136411213e39f2e.json","parameterValues":["{'username': 'liuzhuozhuo', 'password': 111111111}"]}