{"uid":"f8b1f7bc956db4eb","name":"test_shop","fullName":"testcase.test_ui.test_shop.TestShop#test_shop","historyId":"0d01aee41cf847576529800838aa3217","time":{"start":1771127845981,"stop":1771127865678,"duration":19697},"status":"failed","statusMessage":"AssertionError: assert 'http://127.0...oginInfo.html' == 'http://127.0.0.1:8000/'\n  \n  - http://127.0.0.1:8000/\n  + http://127.0.0.1:8000/?s=user/loginInfo.html","statusTrace":"self = <testcase.test_ui.test_shop.TestShop object at 0x0000020ADB9C9970>\ntest_login3 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ae26ef3ee04d42c86f7b767c1143d498\")>\n\n    def test_shop(self,test_login3):\n        # 初始化浏览器\n        driver = test_login3\n        # 获取登陆按钮元素，点击登陆按钮\n        login=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[5]/div/div[1]/div[2]/a[1]')\n        login.click()\n        sleep(1)\n        #跳转到登陆页面，切换登陆账号密码页面进行登陆\n        login_tab=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/ul/li[1]/a')\n        login_tab.click()\n        #使用显式等待，等待元素可见，等待账号可见\n        zh=WebDriverWait(driver,10,0.5).until(\n            EC.element_to_be_clickable((By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[1]/input'))\n        )\n        #点击账号并输入18819781752\n        zh.click()\n        zh.send_keys(\"18819781752\")\n    \n        #获取密码元素并输入密码\n        pwd=WebDriverWait(driver,10,0.5).until(\n            EC.element_to_be_clickable((By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[2]/input'))\n        )\n        pwd.click()\n        pwd.send_keys(\"123456\")\n        driver.execute_script(\"window.scrollBy(0,180);\")\n        #获取图像位置，并提取图像文字，识别到的\n        captch_img=driver.find_element(By.XPATH,'//*[@id=\"form-verify-img\"]')\n        captch_img.screenshot(\"./captcha_shop.jpg\")\n        # ========== 以下是新增/修改的验证码识别逻辑 ==========\n        # 1. 打开图片并做预处理（灰度+二值化+增强对比度）\n        img = Image.open(\"./captcha_shop.jpg\")\n        img = img.convert(\"L\")  # 转灰度图\n        threshold = 110  # 二值化阈值，可根据实际验证码调整\n        img = img.point(lambda x: 255 if x > threshold else 0)  # 二值化\n        enhancer = ImageEnhance.Contrast(img)\n        img = enhancer.enhance(2.0)  # 增强对比度\n    \n        # 2. 配置Tesseract仅识别数字，指定模式\n        config = r'-l eng --psm 8 -c tessedit_char_whitelist=0123456789'\n        captcha_text = pytesseract.image_to_string(img, config=config).strip()\n        # 以上是新增/修改的验证码识别逻辑\n        sleep(5)\n        print(f\"识别到的验证码: {captcha_text}\")\n        #定位验证码输入框\n        yzm_input=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[3]/input')\n        #输入验证码\n        yzm_input.send_keys(captcha_text)\n        btn_click=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[4]/button')\n        sleep(2)\n        #点击按钮\n        # 文字弹窗定位一下子就消失了，所有只定位地址\n        # expectes_msg=driver.\n        btn_click.click()\n        sleep(10)\n        current_url=driver.current_url\n>       assert current_url==\"http://127.0.0.1:8000/\"\nE       AssertionError: assert 'http://127.0...oginInfo.html' == 'http://127.0.0.1:8000/'\nE         \nE         - http://127.0.0.1:8000/\nE         + http://127.0.0.1:8000/?s=user/loginInfo.html\n\ntestcase\\test_ui\\test_shop.py:73: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"test_login3","time":{"start":1771127843342,"stop":1771127845981,"duration":2639},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert 'http://127.0...oginInfo.html' == 'http://127.0.0.1:8000/'\n  \n  - http://127.0.0.1:8000/\n  + http://127.0.0.1:8000/?s=user/loginInfo.html","statusTrace":"self = <testcase.test_ui.test_shop.TestShop object at 0x0000020ADB9C9970>\ntest_login3 = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"ae26ef3ee04d42c86f7b767c1143d498\")>\n\n    def test_shop(self,test_login3):\n        # 初始化浏览器\n        driver = test_login3\n        # 获取登陆按钮元素，点击登陆按钮\n        login=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[5]/div/div[1]/div[2]/a[1]')\n        login.click()\n        sleep(1)\n        #跳转到登陆页面，切换登陆账号密码页面进行登陆\n        login_tab=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/ul/li[1]/a')\n        login_tab.click()\n        #使用显式等待，等待元素可见，等待账号可见\n        zh=WebDriverWait(driver,10,0.5).until(\n            EC.element_to_be_clickable((By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[1]/input'))\n        )\n        #点击账号并输入18819781752\n        zh.click()\n        zh.send_keys(\"18819781752\")\n    \n        #获取密码元素并输入密码\n        pwd=WebDriverWait(driver,10,0.5).until(\n            EC.element_to_be_clickable((By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[2]/input'))\n        )\n        pwd.click()\n        pwd.send_keys(\"123456\")\n        driver.execute_script(\"window.scrollBy(0,180);\")\n        #获取图像位置，并提取图像文字，识别到的\n        captch_img=driver.find_element(By.XPATH,'//*[@id=\"form-verify-img\"]')\n        captch_img.screenshot(\"./captcha_shop.jpg\")\n        # ========== 以下是新增/修改的验证码识别逻辑 ==========\n        # 1. 打开图片并做预处理（灰度+二值化+增强对比度）\n        img = Image.open(\"./captcha_shop.jpg\")\n        img = img.convert(\"L\")  # 转灰度图\n        threshold = 110  # 二值化阈值，可根据实际验证码调整\n        img = img.point(lambda x: 255 if x > threshold else 0)  # 二值化\n        enhancer = ImageEnhance.Contrast(img)\n        img = enhancer.enhance(2.0)  # 增强对比度\n    \n        # 2. 配置Tesseract仅识别数字，指定模式\n        config = r'-l eng --psm 8 -c tessedit_char_whitelist=0123456789'\n        captcha_text = pytesseract.image_to_string(img, config=config).strip()\n        # 以上是新增/修改的验证码识别逻辑\n        sleep(5)\n        print(f\"识别到的验证码: {captcha_text}\")\n        #定位验证码输入框\n        yzm_input=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[3]/input')\n        #输入验证码\n        yzm_input.send_keys(captcha_text)\n        btn_click=driver.find_element(By.XPATH,'/html/body/div[1]/div[1]/div[3]/div/div[2]/div[2]/div[2]/div/div[1]/div[1]/form/div[4]/button')\n        sleep(2)\n        #点击按钮\n        # 文字弹窗定位一下子就消失了，所有只定位地址\n        # expectes_msg=driver.\n        btn_click.click()\n        sleep(10)\n        current_url=driver.current_url\n>       assert current_url==\"http://127.0.0.1:8000/\"\nE       AssertionError: assert 'http://127.0...oginInfo.html' == 'http://127.0.0.1:8000/'\nE         \nE         - http://127.0.0.1:8000/\nE         + http://127.0.0.1:8000/?s=user/loginInfo.html\n\ntestcase\\test_ui\\test_shop.py:73: AssertionError","steps":[],"attachments":[{"uid":"c2cbafc213344668","name":"log","source":"c2cbafc213344668.txt","type":"text/plain","size":419}],"parameters":[],"hasContent":true,"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"attachmentStep":false},"afterStages":[{"name":"test_login3::0","time":{"start":1771127865685,"stop":1771127867894,"duration":2209},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"testcase.test_ui"},{"name":"suite","value":"test_shop"},{"name":"subSuite","value":"TestShop"},{"name":"host","value":"PC-20250907ITIM"},{"name":"thread","value":"15456-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcase.test_ui.test_shop"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"f8b1f7bc956db4eb.json","parameterValues":[]}